# 特定任务成就功能测试指南

## 新功能概览
现在成就系统支持"完成特定任务"条件类型，允许用户创建针对特定任务的成就。

## 测试步骤

### 1. 准备工作
1. 启动应用
2. 创建几个测试任务：
   - "学习Flutter基础" (任意难度)
   - "完成项目文档" (任意难度)
   - "代码审查" (任意难度)

### 2. 创建特定任务成就
1. 点击头像进入个人资料页面
2. 切换到"成就管理"标签
3. 点击"+"按钮添加成就
4. 填写成就信息：
   - **成就标题**: "文档完成者"
   - **成就描述**: "完成项目文档任务"
   - **图标**: 📝
   - **成就类型**: 选择合适的类型
   - **条件类型**: **选择"完成特定任务"** ⭐
   - **选择目标任务**: 从下拉菜单选择"完成项目文档" ⭐
   - **目标数值**: 自动设为1（禁用编辑）⭐
   - **奖励经验**: 100
   - **奖励金币**: 50

### 3. 验证成就创建
- [ ] 确认难度选择器消失，任务选择器出现
- [ ] 确认目标数值字段自动设为1且无法编辑
- [ ] 确认帮助文本显示"完成指定的任务（自动设为1）"
- [ ] 确认可以从任务列表中选择目标任务
- [ ] 确认保存成功

### 4. 测试成就进度
1. 在成就列表中找到"文档完成者"成就
2. 确认当前进度为0/1
3. 回到主页面，完成"完成项目文档"任务
4. 返回成就页面，确认进度更新为1/1
5. 确认成就状态变为已解锁

### 5. 测试边界情况
1. **任务未选择**: 尝试保存没有选择目标任务的成就
   - 应该显示验证错误"请选择目标任务"
   
2. **任务删除后**: 删除目标任务，检查成就是否仍正常显示
   
3. **重复完成**: 多次切换任务完成状态，确认成就进度正确

### 6. 数据持久化测试
1. 创建特定任务成就后重启应用
2. 确认成就信息正确加载（包括目标任务信息）
3. 确认成就进度正确保存

## 预期结果

### ✅ 应该正常工作的功能
- 条件类型切换时UI正确显示/隐藏相应字段
- 任务选择器显示所有可用任务，包含难度标识
- 目标值自动设为1且不可编辑
- 任务完成时成就进度正确更新
- 成就解锁状态正确变化
- 数据正确持久化到数据库

### 🔧 数据库升级验证
- 数据库版本升级到12
- achievements表包含targetTaskId和targetTaskTitle字段
- 现有成就数据迁移正常

### 🎯 成就检查逻辑
- TaskProvider在任务完成时调用成就检查
- AchievementProvider正确识别specificTask条件
- 只有匹配的特定任务完成才计入进度
- 进度从0变为1时成就自动解锁

## 测试用例示例

### 用例1：创建"学习达成"成就
- 目标任务："学习Flutter基础"
- 预期：完成该任务后成就解锁

### 用例2：创建"代码质量"成就  
- 目标任务："代码审查"
- 预期：只有完成代码审查任务才计入进度

### 用例3：多个特定任务成就
- 创建多个不同目标任务的成就
- 预期：各自独立跟踪，互不影响

## 问题排查

如果功能不正常，检查：
1. 数据库是否正确升级到版本12
2. TaskProvider是否正确设置了AchievementProvider引用
3. 任务完成时是否调用了_checkAchievements方法
4. AchievementProvider的specificTask条件处理是否正确

## 后续优化建议
1. 添加任务删除时的成就清理逻辑
2. 在成就详情中显示目标任务信息
3. 支持选择任务分类而非具体任务
4. 添加成就解锁时的动画效果